GeoBOS=window.GeoBOS||{};GeoBOS.filePicker=GeoBOS.filePicker||{};GeoBOS.filePicker.pickPicture=function(GeoBOS){return function pickpicture(callback){callback=callback||function(){};var doc=window.document;var THUMBNAIL_PATH="/sdcard/.thumbnail/";var PICTURE_PATH="/Camera/";var selectedImageList=[];var rootContainer=doc.createElement("div");rootContainer.style.cssText="position: fixed;top: 0;left: 0;width: 100%;height: 100%;z-index: 2000;background-color: #F2F2F2";rootContainer.id="picture_picker_root";var titlebar=doc.createElement("div");titlebar.style.cssText="font-size: 18px; text-align: center; position: absolute; top: 0px; left: 0px; right: 0px; height: 50px; background: rgb(23, 68, 94); box-shadow: rgb(0, 0, 0) 0px 0px 5px 0px;";titlebar.id="picture_picker_titlebar";var titlebar_back=doc.createElement("div");titlebar_back.style.cssText="position: absolute;top: 15px;left: 0px;bottom: 0px;padding-right: 10px;padding-left: 10px;user-select: none;color: white;";titlebar_back.innerHTML="<返回";titlebar_back.id="picture_picker_titlebar_back";titlebar_back.onclick=onBack;var tiltebar_title=doc.createElement("div");tiltebar_title.style.cssText="color: white;margin-left: 18px;margin-top: 15px";tiltebar_title.innerHTML="图片选择器";tiltebar_title.id="picture_picker_titlebar_title";var tiltebar_confirm=doc.createElement("div");tiltebar_confirm.style.cssText="position: absolute;color: white;top: 15px;right: 0;bottom: 0;padding-right: 10px;padding-left: 10px;user-select: none; -moz-user-select: none; -ms-user-select: none; -webkit-user-select: none";tiltebar_confirm.innerHTML="确定";tiltebar_confirm.id="picture_picker_titlebar_confirm";tiltebar_confirm.onclick=onPictureSelected;titlebar.appendChild(titlebar_back);titlebar.appendChild(tiltebar_title);titlebar.appendChild(tiltebar_confirm);var container=doc.createElement("div");container.style.cssText="position: absolute;top: 50px;overflow-y: auto;left: 0;right: 0;bottom:0";var gridView=doc.createElement("div");container.appendChild(gridView);var selectedView=doc.createElement("div");selectedView.style.cssText="position: absolute;top: 50px;width: 100%;height: 100%;left: 0;right: 0;bottom:0;background-color: rgba(55,55,55,0.9);";var previewImage=new Image;previewImage.style.cssText="top: 50px;width: 100%; height: 100%; left: 0px; right: 0px;";selectedView.style.display="none";selectedView.appendChild(previewImage);rootContainer.appendChild(titlebar);rootContainer.appendChild(container);rootContainer.appendChild(selectedView);doc.body.appendChild(rootContainer);function createImageGrid(number){function getPosition(number){return{x:Math.floor(number%4),y:Math.floor(number/4)}}var position=getPosition(number);var grid=doc.createElement("div");grid.className="picture_picker_image_item";grid.style.cssText="position: absolute; width: 80px; height: 80px;";grid.style.left=20+position.x*80+"px";grid.style.top=10+position.y*80+"px";var grid_image=doc.createElement("img");grid_image.style.cssText="width: 75px; height: 75px;";var grid_selected_status=doc.createElement("button");grid_selected_status.style.cssText="position: absolute; top: 0px; right: 5px; width: 15px; height: 15px; background-color: rgb(239, 239, 239); border-radius: 7px;";grid.appendChild(grid_image);grid.appendChild(grid_selected_status);return grid}GeoBOS.fs.readdir(PICTURE_PATH,function(err,res){if(err){return callback(err)}var imageList=[];for(var i=0,fileLength=res.fileList.length;i<fileLength;i++){var item=res.fileList[i];var suffix=item.split(".").pop();if(suffix==="png"||suffix==="bmp"||suffix==="gif"||suffix==="jpg"||suffix==="jpeg"){imageList.push(item)}}for(var j=0,imgLength=imageList.length;j<imgLength;j++){var imageItem=createImageGrid(j);var image=imageItem.firstChild;var imageSelectedStatus=imageItem.lastChild;image.src=THUMBNAIL_PATH+imageList[j];image.onerror=imageNotFound;function imageNotFound(event){var img=event.srcElement;img.src="/sdcard/Camera/"+img.src.split("/").pop();img.onerror=null}image.onclick=function(event){var target=event.target;var fileName=target.src.split("/").pop();var originFilePath="/sdcard/Camera/"+fileName;previewImage.src=originFilePath;selectedView.style.display="block"};imageSelectedStatus.onclick=function(event){var currentColor=event.target.style.backgroundColor;var target=event.target;var imgElement=target.previousSibling;if(target.className==="picture_picker_image_item_selected"){target.className="";target.style.backgroundColor="rgb(239, 239, 239)";for(var index=0;index<selectedImageList.length;index++){if(selectedImageList[index]===imgElement.src){selectedImageList.splice(index,1);break}}}else{target.className="picture_picker_image_item_selected";target.style.backgroundColor="rgb(0, 255, 0)";selectedImageList.push(imgElement.src)}};gridView.appendChild(imageItem)}});function onBack(){console.log("back:"+selectedView.style.display);if("block"===selectedView.style.display){previewImage.src="";selectedView.style.display="none"}else{exit()}}function exit(){doc.removeEventListener("keyup",onKeyDown,false);doc.body.removeChild(rootContainer)}function onPictureSelected(){var returnImgList=[];for(var index=0;index<selectedImageList.length;index++){returnImgList.push(selectedImageList[index].split("/").pop())}callback(null,returnImgList);exit()}function onKeyDown(e){var BACK_KEYCODE=4;var event=e||window.event;if(e.which===BACK_KEYCODE){onBack()}event.preventDefault();return false}doc.addEventListener("keyup",onKeyDown,false)}}(window.GeoBOS,this.value);